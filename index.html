<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Super Bowl Squares - Live Update</title>
  <style>
    :root {
      --cell-base: 9vw;
      --cell-min: 32px;
      --cell-max: 50px;
      --gap: 2px;
    }

    * { box-sizing: border-box; }

    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 15px 8px;
      text-align: center;
      -webkit-text-size-adjust: 100%;
      touch-action: manipulation;
    }

    h1 {
      color: #2c3e50;
      margin: 0 0 12px;
      font-size: clamp(1.4rem, 5vw, 1.8rem);
    }

    #controls, #info, #scoreDisplay, #quarterWinners, #status {
      max-width: 100%;
      margin-left: auto;
      margin-right: auto;
    }

    #controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 12px 0 20px;
    }

    #controls input, #controls button {
      padding: 10px 14px;
      font-size: clamp(0.95rem, 3.5vw, 1rem);
      border: 1px solid #bdc3c7;
      border-radius: 6px;
      width: 100%;
      max-width: 320px;
    }

    #controls button {
      background: #27ae60;
      color: white;
      border: none;
      cursor: pointer;
    }

    #controls button:hover {
      background: #219a52;
    }

    #info, #status {
      font-size: clamp(0.85rem, 3vw, 0.95rem);
      color: #555;
      margin: 6px 0;
    }

    #scoreDisplay {
      font-size: clamp(1.2rem, 4.5vw, 1.5rem);
      font-weight: bold;
      margin: 10px 0;
      color: #2c3e50;
    }

    #quarterWinners {
      font-size: clamp(0.9rem, 3.2vw, 1rem);
      line-height: 1.4;
      margin: 12px 0;
      min-height: 40px;
    }

    table {
      margin: 0 auto;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 100%;
    }

    th, td {
      border: 1px solid #bdc3c7;
      padding: clamp(4px, 1.5vw, 8px);
      text-align: center;
      font-size: clamp(0.78rem, 2.8vw, 0.9rem);
      width: calc(var(--cell-base) + var(--gap) * 2);
      min-width: var(--cell-min);
      max-width: var(--cell-max);
      height: calc(var(--cell-base) + var(--gap) * 2);
      max-height: var(--cell-max);
    }

    .header {
      background: #2c3e50;
      color: white;
      font-weight: bold;
    }

    .row-label {
      font-weight: bold;
      width: 28px;
      min-width: 28px;
      max-width: 36px;
      font-size: clamp(0.85rem, 3vw, 1rem);
    }

    .digit-bold {
      font-weight: bold;
      color: #006400;
    }

    .quarter-label {
      font-size: clamp(0.58rem, 2vw, 0.68rem);
      color: #006400;
      font-weight: bold;
      display: block;
      margin-top: 2px;
      background: rgba(40, 167, 69, 0.1);
      border-radius: 3px;
      padding: 1px 3px;
    }

    .pulsate {
      animation: pulsate 2s infinite ease-in-out;
      font-weight: bold;
    }

    @keyframes pulsate {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .current-winner-border {
      border: 3.5px solid #28a745 !important;
      box-shadow: 0 0 12px #28a745;
    }

    .corner-label {
      font-size: clamp(0.9rem, 3.2vw, 1rem);
      line-height: 1.3;
      white-space: pre;
    }

    @media (max-width: 480px) {
      body { padding: 12px 6px; }
      h1 { font-size: 1.4em; margin-bottom: 10px; }
      table { font-size: 0.82em; }
      th, td { padding: 5px 3px; }
      .row-label { width: 24px; min-width: 24px; font-size: 0.88em; }
      #controls { flex-direction: column; gap: 8px; }
      #controls input, #controls button { width: 100%; max-width: 320px; }
      #scoreDisplay { font-size: 1.2em; }
      .quarter-label { font-size: 0.6em; padding: 1px 2px; }
      .corner-label { font-size: 0.9em; }
    }

    @media (max-width: 360px) {
      table { font-size: 0.78em; }
      th, td { padding: 4px 2px; }
    }
  </style>
</head>
<body>

  <h1>Super Bowl Squares - Live Update</h1>

  <div id="controls">
    <input type="text" id="gameId" value="401772987" placeholder="Enter ESPN Game ID">
    <button id="refreshBtn">Refresh Now</button>
  </div>

  <div id="info">Auto-refreshing every 10 seconds</div>

  <div id="scoreDisplay">Score: —</div>
  <div id="quarterWinners"></div>
  <div id="status">Loading game data...</div>

  <table id="gridTable"></table>

  <script>
    const DEFAULT_GAME_ID = "401772987";

    const gridMap = {
      "4-1": "Harry", "4-4": "Hermione", "4-7": "Ron", "4-2": "Ginny",
      "4-9": "Luna", "4-6": "Neville", "4-8": "Dudley", "4-3": "Ginny",
      "4-0": "Arthur", "4-5": "Kreacher",
      "0-1": "Padma", "0-4": "Parvati", "0-7": "Kingsley", "0-2": "Seamus",
      "0-9": "Dean", "0-6": "Viktor", "0-8": "Hermione", "0-3": "Draco",
      "0-0": "Sybill", "0-5": "Harry",
      "2-1": "Molly", "2-4": "Arthur", "2-7": "George", "2-2": "Ron",
      "2-9": "Bill", "2-6": "Minerva", "2-8": "Hagrid", "2-3": "Luna",
      "2-0": "Percy", "2-5": "Padma",
      "5-1": "Cho", "5-4": "Charlie", "5-7": "Dudley", "5-2": "Sybill",
      "5-9": "Harry", "5-6": "Lavender", "5-8": "Neville", "5-3": "Cho",
      "5-0": "Hermione", "5-5": "Teddy",
      "1-1": "Seamus", "1-4": "Fleur", "1-7": "Nicholas", "1-2": "Hermione",
      "1-9": "Draco", "1-6": "Parvati", "1-8": "Cho", "1-3": "Ron",
      "1-0": "Molly", "1-5": "Neville",
      "8-1": "Ginny", "8-4": "Kingsley", "8-7": "Luna", "8-2": "Molly",
      "8-9": "Arthur", "8-6": "Ginny", "8-8": "Percy", "8-3": "George",
      "8-0": "Viktor", "8-5": "Seamus",
      "6-1": "Viktor", "6-4": "Peeves", "6-7": "Teddy", "6-2": "Ron",
      "6-9": "Padma", "6-6": "Fleur", "6-8": "Hermione", "6-3": "Harry",
      "6-0": "Minerva", "6-5": "Dudley",
      "3-1": "Charlie", "3-4": "Hermione", "3-7": "Hagrid", "3-2": "Neville",
      "3-9": "Harry", "3-6": "Grawp", "3-8": "Dean", "3-3": "Aberforth",
      "3-0": "Parvati", "3-5": "Hermione",
      "9-1": "Dean", "9-4": "Harry", "9-7": "Ginny", "9-2": "Kreacher",
      "9-9": "Seamus", "9-6": "Aberforth", "9-8": "Charlie", "9-3": "Draco",
      "9-0": "Luna", "9-5": "Dean",
      "7-1": "Neville", "7-4": "Horace", "7-7": "Dean", "7-2": "Ginny",
      "7-9": "Ron", "7-6": "Luna", "7-8": "Hermione", "7-3": "Fleur",
      "7-0": "Arthur", "7-5": "Ginny"
    };

    const rowOrder = [4, 0, 2, 5, 1, 8, 6, 3, 9, 7];
    const colOrder = [1, 4, 7, 2, 9, 6, 8, 3, 0, 5];

    const table = document.getElementById("gridTable");

    const cornerTh = document.createElement("th");
    cornerTh.className = "header corner-label";
    cornerTh.id = "cornerLabel";
    cornerTh.innerHTML = "Loading...";

    const colHeaderRow = document.createElement("tr");
    colHeaderRow.appendChild(cornerTh);
    colOrder.forEach(colNum => {
      const th = document.createElement("th");
      th.textContent = colNum;
      th.className = "header";
      colHeaderRow.appendChild(th);
    });
    table.appendChild(colHeaderRow);

    rowOrder.forEach(row => {
      const tr = document.createElement("tr");
      const rowTh = document.createElement("th");
      rowTh.textContent = row;
      rowTh.className = "header row-label";
      tr.appendChild(rowTh);

      colOrder.forEach(col => {
        const key = `${row}-${col}`;
        const td = document.createElement("td");
        td.textContent = gridMap[key] || "(empty)";
        if (!gridMap[key]) td.className = "empty";
        td.dataset.row = row;
        td.dataset.col = col;
        tr.appendChild(td);
      });

      table.appendChild(tr);
    });

    function getNameFromSquare(rowDigit, colDigit) {
      const row = parseInt(rowDigit);
      const col = parseInt(colDigit);
      const key = `${row}-${col}`;
      return gridMap[key] || "(empty)";
    }

    async function updateGame() {
      const gameId = document.getElementById("gameId")?.value?.trim() || DEFAULT_GAME_ID;
      document.getElementById("status").textContent = "Refreshing...";

      try {
        const url = `https://site.api.espn.com/apis/site/v2/sports/football/nfl/summary?event=${gameId}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);

        const data = await res.json();

        const comp = data.header?.competitions?.[0] || {};
        const competitors = comp.competitors || [];
        const home = competitors.find(c => c.homeAway === "home") || {};
        const away = competitors.find(c => c.homeAway === "away") || {};

        const homeScore = home.score || 0;
        const awayScore = away.score || 0;
        const homeName = home.team?.abbreviation || home.team?.displayName?.slice(0,3).toUpperCase() || "HOME";
        const awayName = away.team?.abbreviation || away.team?.displayName?.slice(0,3).toUpperCase() || "AWAY";

        document.getElementById("cornerLabel").innerHTML = `${awayName} →<br>↓ ${homeName}`;

        document.getElementById("scoreDisplay").textContent = 
          `${awayName} ${awayScore} – ${homeScore} ${homeName}`;

        document.querySelectorAll("#gridTable td .quarter-label").forEach(el => el.remove());

        const homeQuarters = home.linescores || [];
        const awayQuarters = away.linescores || [];

        let html = "";

        if (homeQuarters.length > 0 || awayQuarters.length > 0) {
          html = "<strong>Quarter-by-Quarter Grid Winners:</strong><br>";
          let cumulativeHome = 0;
          let cumulativeAway = 0;

          const maxQ = Math.max(homeQuarters.length, awayQuarters.length, 4);

          for (let q = 0; q < maxQ; q++) {
            const homeQ = parseInt(homeQuarters[q]?.displayValue || "0", 10);
            const awayQ = parseInt(awayQuarters[q]?.displayValue || "0", 10);

            cumulativeHome += homeQ;
            cumulativeAway += awayQ;

            const qLabel = q < 4 ? `Q${q+1}` : (q === 4 ? "OT" : "Final");

            const awayLast = cumulativeAway % 10;
            const homeLast = cumulativeHome % 10;
            const winnerName = getNameFromSquare(awayLast, homeLast);

            const awayScoreText = cumulativeAway.toString().slice(0, -1) + `<span class="digit-bold">${awayLast}</span>`;
            const homeScoreText = cumulativeHome.toString().slice(0, -1) + `<span class="digit-bold">${homeLast}</span>`;

            html += `${qLabel}: ${awayName} ${awayScoreText} – ${homeName} ${homeScoreText} → ${winnerName}<br>`;

            document.querySelectorAll("#gridTable td").forEach(cell => {
              if (parseInt(cell.dataset.row) === awayLast && parseInt(cell.dataset.col) === homeLast) {
                const label = document.createElement("span");
                label.className = "quarter-label";
                label.textContent = `${qLabel} Winner`;
                cell.appendChild(label);
              }
            });
          }
        }

        document.getElementById("quarterWinners").innerHTML = html;

        document.querySelectorAll(".pulsate, .current-winner-border").forEach(el => {
          el.classList.remove("pulsate", "current-winner-border");
        });

        document.querySelectorAll("#gridTable td").forEach(cell => {
          if (parseInt(cell.dataset.row) === awayScore % 10 && parseInt(cell.dataset.col) === homeScore % 10) {
            cell.classList.add("pulsate", "current-winner-border");
          }
        });

        const now = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
        document.getElementById("status").textContent = `Last refresh: ${now}`;

      } catch (err) {
        console.error(err);
        document.getElementById("status").textContent = `Error: ${err.message || "Failed to load"}`;
      }
    }

    updateGame();
    setInterval(updateGame, 10000);
    document.getElementById("refreshBtn").addEventListener("click", updateGame);
  </script>

</body>
</html>