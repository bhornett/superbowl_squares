<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Super Bowl Squares - Live Update</title>
  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 40px 20px;
      text-align: center;
    }
    h1 {
      color: #2c3e50;
      margin-bottom: 20px;
    }
    table {
      margin: 0 auto;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      font-size: 1.05em;
    }
    th, td {
      border: 1px solid #bdc3c7;
      padding: 12px 16px;
      min-width: 120px;
      text-align: center;
      position: relative;
    }
    th {
      background: #3498db;
      color: white;
      font-weight: bold;
    }
    tr:nth-child(even) {
      background: #f9fbfc;
    }
    .empty {
      color: #95a5a6;
      font-style: italic;
    }
    .header {
      background: #2c3e50;
      color: white;
      font-weight: bold;
    }
    .row-label {
      font-weight: bold;
      min-width: 60px !important;
    }
    .pulsate {
      animation: pulsate 2s infinite ease-in-out;
      font-weight: bold;
    }
    @keyframes pulsate {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .current-winner-border {
      border: 4px solid #28a745 !important;
      box-shadow: 0 0 15px #28a745;
    }
    .digit-bold {
      font-weight: bold;
      color: #006400;
    }
    .quarter-label {
      font-size: 0.75em;
      color: #006400;
      font-weight: bold;
      display: block;
      margin-top: 4px;
      background: rgba(40, 167, 69, 0.1);
      border-radius: 4px;
      padding: 2px 4px;
    }
    #controls {
      margin: 20px 0 30px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    #controls input, #controls button {
      padding: 10px 14px;
      font-size: 1em;
      border: 1px solid #bdc3c7;
      border-radius: 4px;
    }
    #controls button {
      background: #27ae60;
      color: white;
      border: none;
      cursor: pointer;
    }
    #controls button:hover {
      background: #219a52;
    }
    #info {
      font-size: 1.1em;
      color: #555;
      margin-bottom: 10px;
    }
    #scoreDisplay {
      font-size: 1.5em;
      font-weight: bold;
      margin: 15px 0;
      color: #2c3e50;
    }
    #quarterWinners {
      font-size: 1.1em;
      line-height: 1.6;
      margin: 20px 0;
      min-height: 50px;
    }
    #status {
      font-size: 1em;
      color: #666;
      margin: 10px 0;
    }
    .corner-label {
      font-size: 1.1em;
      line-height: 1.4;
      white-space: pre;
    }
  </style>
</head>
<body>

  <h1>Super Bowl Squares - Live Update</h1>

  <div id="controls">
    <input type="text" id="gameId" value="401772987" placeholder="Enter ESPN Game ID">
    <button id="refreshBtn">Refresh Now</button>
  </div>

  <div id="info">Auto-refreshing every 10 seconds</div>

  <div id="scoreDisplay">Score: —</div>
  <div id="quarterWinners"></div>
  <div id="status">Loading game data...</div>

  <table id="gridTable"></table>

  <script>
    const DEFAULT_GAME_ID = "401772987";

    const gridMap = {
      "4-1": "Harry", "4-4": "Hermione", "4-7": "Ron", "4-2": "Ginny",
      "4-9": "Luna", "4-6": "Neville", "4-8": "Dudley", "4-3": "Ginny",
      "4-0": "Arthur", "4-5": "Kreacher",
      "0-1": "Padma", "0-4": "Parvati", "0-7": "Kingsley", "0-2": "Seamus",
      "0-9": "Dean", "0-6": "Viktor", "0-8": "Hermione", "0-3": "Draco",
      "0-0": "Sybill", "0-5": "Harry",
      "2-1": "Molly", "2-4": "Arthur", "2-7": "George", "2-2": "Ron",
      "2-9": "Bill", "2-6": "Minerva", "2-8": "Hagrid", "2-3": "Luna",
      "2-0": "Percy", "2-5": "Padma",
      "5-1": "Cho", "5-4": "Charlie", "5-7": "Dudley", "5-2": "Sybill",
      "5-9": "Harry", "5-6": "Lavender", "5-8": "Neville", "5-3": "Cho",
      "5-0": "Hermione", "5-5": "Teddy",
      "1-1": "Seamus", "1-4": "Fleur", "1-7": "Nicholas", "1-2": "Hermione",
      "1-9": "Draco", "1-6": "Parvati", "1-8": "Cho", "1-3": "Ron",
      "1-0": "Molly", "1-5": "Neville",
      "8-1": "Ginny", "8-4": "Kingsley", "8-7": "Luna", "8-2": "Molly",
      "8-9": "Arthur", "8-6": "Ginny", "8-8": "Percy", "8-3": "George",
      "8-0": "Viktor", "8-5": "Seamus",
      "6-1": "Viktor", "6-4": "Peeves", "6-7": "Teddy", "6-2": "Ron",
      "6-9": "Padma", "6-6": "Fleur", "6-8": "Hermione", "6-3": "Harry",
      "6-0": "Minerva", "6-5": "Dudley",
      "3-1": "Charlie", "3-4": "Hermione", "3-7": "Hagrid", "3-2": "Neville",
      "3-9": "Harry", "3-6": "Grawp", "3-8": "Dean", "3-3": "Aberforth",
      "3-0": "Parvati", "3-5": "Hermione",
      "9-1": "Dean", "9-4": "Harry", "9-7": "Ginny", "9-2": "Kreacher",
      "9-9": "Seamus", "9-6": "Aberforth", "9-8": "Charlie", "9-3": "Draco",
      "9-0": "Luna", "9-5": "Dean",
      "7-1": "Neville", "7-4": "Horace", "7-7": "Dean", "7-2": "Ginny",
      "7-9": "Ron", "7-6": "Luna", "7-8": "Hermione", "7-3": "Fleur",
      "7-0": "Arthur", "7-5": "Ginny"
    };

    const rowOrder = [4, 0, 2, 5, 1, 8, 6, 3, 9, 7];
    const colOrder = [1, 4, 7, 2, 9, 6, 8, 3, 0, 5];

    const table = document.getElementById("gridTable");

    // Top-left corner with team labels and arrows
    const cornerTh = document.createElement("th");
    cornerTh.className = "header corner-label";
    cornerTh.id = "cornerLabel";
    cornerTh.innerHTML = "Loading teams...";
    cornerTh.title = "Columns → team on top\nRows ↓ team on left";

    // Build column headers
    const colHeaderRow = document.createElement("tr");
    colHeaderRow.appendChild(cornerTh);
    colOrder.forEach(colNum => {
      const th = document.createElement("th");
      th.textContent = colNum;
      th.className = "header";
      colHeaderRow.appendChild(th);
    });
    table.appendChild(colHeaderRow);

    // Build data rows
    rowOrder.forEach(row => {
      const tr = document.createElement("tr");
      const rowTh = document.createElement("th");
      rowTh.textContent = row;
      rowTh.className = "header row-label";
      tr.appendChild(rowTh);

      colOrder.forEach(col => {
        const key = `${row}-${col}`;
        const td = document.createElement("td");
        td.textContent = gridMap[key] || "(empty)";
        if (!gridMap[key]) td.className = "empty";
        td.dataset.row = row;
        td.dataset.col = col;
        tr.appendChild(td);
      });

      table.appendChild(tr);
    });

    // Find name from grid for given last digits
    function getNameFromSquare(rowDigit, colDigit) {
      const row = parseInt(rowDigit);
      const col = parseInt(colDigit);
      const key = `${row}-${col}`;
      return gridMap[key] || "(empty)";
    }

    // Fetch and update
    async function updateGame() {
      const gameId = document.getElementById("gameId")?.value?.trim() || DEFAULT_GAME_ID;
      document.getElementById("status").textContent = "Refreshing...";

      try {
        const url = `https://site.api.espn.com/apis/site/v2/sports/football/nfl/summary?event=${gameId}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);

        const data = await res.json();

        const comp = data.header?.competitions?.[0] || {};
        const competitors = comp.competitors || [];
        const home = competitors.find(c => c.homeAway === "home") || {};
        const away = competitors.find(c => c.homeAway === "away") || {};

        const homeScore = home.score || 0;
        const awayScore = away.score || 0;
        const homeName = home.team?.displayName || "Home";
        const awayName = away.team?.displayName || "Away";

        // Update corner label dynamically
        document.getElementById("cornerLabel").innerHTML = 
          `${awayName} →<br>↓ ${homeName}`;

        document.getElementById("scoreDisplay").textContent = 
          `${awayName} ${awayScore} – ${homeScore} ${homeName}`;

        // Clear previous quarter labels
        document.querySelectorAll("#gridTable td .quarter-label").forEach(el => el.remove());

        // Quarter-by-quarter (only if data exists)
        const homeQuarters = home.linescores || [];
        const awayQuarters = away.linescores || [];

        let html = "";

        if (homeQuarters.length > 0 || awayQuarters.length > 0) {
          html = "<strong>Quarter-by-Quarter Grid Winners:</strong><br>";
          let cumulativeHome = 0;
          let cumulativeAway = 0;

          const maxQ = Math.max(homeQuarters.length, awayQuarters.length, 4);

          for (let q = 0; q < maxQ; q++) {
            const homeQ = parseInt(homeQuarters[q]?.displayValue || "0", 10);
            const awayQ = parseInt(awayQuarters[q]?.displayValue || "0", 10);

            cumulativeHome += homeQ;
            cumulativeAway += awayQ;

            const qLabel = q < 4 ? `Q${q+1}` : (q === 4 ? "OT" : "Final");

            const awayLast = cumulativeAway % 10;
            const homeLast = cumulativeHome % 10;
            const winnerName = getNameFromSquare(awayLast, homeLast);

            const awayScoreText = cumulativeAway.toString().slice(0, -1) + `<span class="digit-bold">${awayLast}</span>`;
            const homeScoreText = cumulativeHome.toString().slice(0, -1) + `<span class="digit-bold">${homeLast}</span>`;

            html += `${qLabel}: ${awayName} ${awayScoreText} – ${homeName} ${homeScoreText} → ${winnerName}<br>`;

            // Add label inside winning cell
            document.querySelectorAll("#gridTable td").forEach(cell => {
              if (parseInt(cell.dataset.row) === awayLast && parseInt(cell.dataset.col) === homeLast) {
                const label = document.createElement("span");
                label.className = "quarter-label";
                label.textContent = `${qLabel} Winner`;
                cell.appendChild(label);
              }
            });
          }
        }

        document.getElementById("quarterWinners").innerHTML = html;

        // Pulsate + green border for current/final winning cell
        document.querySelectorAll(".pulsate, .current-winner-border").forEach(el => {
          el.classList.remove("pulsate", "current-winner-border");
        });

        document.querySelectorAll("#gridTable td").forEach(cell => {
          if (parseInt(cell.dataset.row) === awayScore % 10 && parseInt(cell.dataset.col) === homeScore % 10) {
            cell.classList.add("pulsate", "current-winner-border");
          }
        });

        // Refresh time
        const now = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
        document.getElementById("status").textContent = `Last refresh: ${now}`;

      } catch (err) {
        console.error(err);
        document.getElementById("status").textContent = `Error: ${err.message || "Failed to load"}`;
      }
    }

    // Initial load
    updateGame();

    // Auto-refresh every 10 seconds
    setInterval(updateGame, 10000);

    // Manual refresh
    document.getElementById("refreshBtn").addEventListener("click", updateGame);
  </script>

</body>
</html>