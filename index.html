<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Super Bowl Squares - Live Update</title>
  <style>
    :root {
      --cell-size: clamp(20px, 8.5vw, 96px);   /* square size – fits 11 columns + labels */
      --gap: 1px;
    }

    * { box-sizing: border-box; }

    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 12px 6px;
      text-align: center;
      -webkit-text-size-adjust: 100%;
      touch-action: manipulation;
    }

    h1 {
      color: #2c3e50;
      margin: 0 0 10px;
      font-size: clamp(1.3rem, 4.8vw, 1.7rem);
    }

    #controls, #info, #scoreDisplay, #quarterWinners, #status {
      text-align: center !important;
      margin-left: auto !important;
      margin-right: auto !important;
      display: block !important;
      max-width: 95%;
    }

    #controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin: 10px auto 18px;
    }

    #controls input, #controls button {
      padding: 9px 12px;
      font-size: clamp(0.9rem, 3.4vw, 1rem);
      border: 1px solid #bdc3c7;
      border-radius: 6px;
      width: 100%;
      max-width: 300px;
      margin: 0 auto;
    }

    #controls button {
      background: #27ae60;
      color: white;
      border: none;
      cursor: pointer;
    }

    #controls button:hover {
      background: #219a52;
    }

    #info, #status {
      font-size: clamp(0.8rem, 3vw, 0.9rem);
      color: #555;
      margin: 5px auto;
    }

    #scoreDisplay {
      font-size: clamp(1.15rem, 4.2vw, 1.4rem);
      font-weight: bold;
      margin: 8px auto;
      color: #2c3e50;
    }

    #quarterWinners {
      font-size: clamp(0.85rem, 3vw, 0.95rem);
      line-height: 1.4;
      margin: 10px auto;
      min-height: 36px;
    }

    table {
      margin: 0 auto;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 100%;
      table-layout: fixed;           /* critical: forces equal column widths */
    }

    th, td {
      border: 1px solid #bdc3c7;
      padding: 4px;
      text-align: center;
      font-size: clamp(0.72rem, 2.6vw, 0.85rem);
      width: var(--cell-size) !important;
      height: var(--cell-size) !important;
      min-width: var(--cell-size);
      max-width: var(--cell-size);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    @media (max-width: 480px) {
      th, td {
        white-space: normal;
        word-break: break-word;
        hyphens: auto;
        padding: 3px;
      }
    }

    .header {
      background: #2c3e50;
      color: white;
      font-weight: bold;
    }

    .row-label {
      font-weight: bold;
      width: clamp(24px, 6vw, 32px) !important;
      min-width: 24px;
      font-size: clamp(0.8rem, 3vw, 0.95rem);
    }

    .digit-bold {
      font-weight: bold;
      color: #006400;
    }

    .quarter-label {
      font-size: clamp(0.55rem, 2vw, 0.65rem);
      color: #006400;
      font-weight: bold;
      display: block;
      margin-top: 2px;
      background: rgba(40, 167, 69, 0.1);
      border-radius: 3px;
      padding: 1px 2px;
      white-space: nowrap;
    }

    .pulsate {
      animation: pulsate 2s infinite ease-in-out;
      font-weight: bold;
    }

    @keyframes pulsate {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .current-winner-border {
      border: 3.5px solid #28a745 !important;
      box-shadow: 0 0 12px #28a745;
    }

    .corner-label {
      font-size: clamp(0.85rem, 3vw, 1rem);
      line-height: 1.3;
      white-space: pre;
    }

    @media (max-width: 480px) {
      body { padding: 10px 5px; }
      h1 { font-size: 1.35em; margin-bottom: 8px; }
      table { font-size: 0.8em; }
      th, td { padding: 4px 2px; }
      .row-label { width: 22px !important; min-width: 22px; font-size: 0.85em; }
      #controls { flex-direction: column; gap: 8px; }
      #controls input, #controls button { width: 100%; max-width: 340px; }
      #scoreDisplay { font-size: 1.18em; }
      .quarter-label { font-size: 0.58em; padding: 1px 2px; }
      .corner-label { font-size: 0.88em; }
    }
  </style>
</head>
<body>

  <h1>Super Bowl Squares - Live Update</h1>

  <div id="controls">
    <input type="text" id="gameId" value="401772987" placeholder="Enter ESPN Game ID">
    <button id="refreshBtn">Refresh Now</button>
  </div>

  <div id="info">Auto-refreshing every 10 seconds</div>

  <div id="scoreDisplay">Score: —</div>
  <div id="quarterWinners"></div>
  <div id="status">Loading game data...</div>

  <table id="gridTable"></table>

  <script>
    const DEFAULT_GAME_ID = "401772987";

const gridMap = {
  // Row 4
  "4-1": "HAR",
  "4-4": "HER",
  "4-7": "RON",
  "4-2": "GIN",
  "4-9": "LUN",
  "4-6": "NEV",
  "4-8": "DUD",
  "4-3": "GIN",
  "4-0": "ART",
  "4-5": "KRE",

  // Row 0
  "0-1": "PAD",
  "0-4": "PAR",
  "0-7": "KIN",
  "0-2": "SEA",
  "0-9": "DEA",
  "0-6": "VIK",
  "0-8": "HER",
  "0-3": "DRA",
  "0-0": "SYB",
  "0-5": "HAR",

  // Row 2
  "2-1": "MOL",
  "2-4": "ART",
  "2-7": "GEO",
  "2-2": "RON",
  "2-9": "BIL",
  "2-6": "MIN",
  "2-8": "HAG",
  "2-3": "LUN",
  "2-0": "PER",
  "2-5": "PAD",

  // Row 5
  "5-1": "CHO",
  "5-4": "CHA",
  "5-7": "DUD",
  "5-2": "SYB",
  "5-9": "HAR",
  "5-6": "LAV",
  "5-8": "NEV",
  "5-3": "CHO",
  "5-0": "HER",
  "5-5": "TED",

  // Row 1
  "1-1": "SEA",
  "1-4": "FLE",
  "1-7": "NIC",
  "1-2": "HER",
  "1-9": "DRA",
  "1-6": "PAR",
  "1-8": "CHO",
  "1-3": "RON",
  "1-0": "MOL",
  "1-5": "NEV",

  // Row 8
  "8-1": "GIN",
  "8-4": "KIN",
  "8-7": "LUN",
  "8-2": "MOL",
  "8-9": "ART",
  "8-6": "GIN",
  "8-8": "PER",
  "8-3": "GEO",
  "8-0": "VIK",
  "8-5": "SEA",

  // Row 6
  "6-1": "VIK",
  "6-4": "PEE",
  "6-7": "TED",
  "6-2": "RON",
  "6-9": "PAD",
  "6-6": "FLE",
  "6-8": "HER",
  "6-3": "HAR",
  "6-0": "MIN",
  "6-5": "DUD",

  // Row 3
  "3-1": "CHA",
  "3-4": "HER",
  "3-7": "HAG",
  "3-2": "NEV",
  "3-9": "HAR",
  "3-6": "GRA",
  "3-8": "DEA",
  "3-3": "ABE",
  "3-0": "PAR",
  "3-5": "HER",

  // Row 9
  "9-1": "DEA",
  "9-4": "HAR",
  "9-7": "GIN",
  "9-2": "KRE",
  "9-9": "SEA",
  "9-6": "ABE",
  "9-8": "CHA",
  "9-3": "DRA",
  "9-0": "LUN",
  "9-5": "DEA",

  // Row 7
  "7-1": "NEV",
  "7-4": "HOR",
  "7-7": "DEA",
  "7-2": "GIN",
  "7-9": "RON",
  "7-6": "LUN",
  "7-8": "HER",
  "7-3": "FLE",
  "7-0": "ART",
  "7-5": "GIN"
};


    const rowOrder = [4, 0, 2, 5, 1, 8, 6, 3, 9, 7];
    const colOrder = [1, 4, 7, 2, 9, 6, 8, 3, 0, 5];

    const table = document.getElementById("gridTable");

    const cornerTh = document.createElement("th");
    cornerTh.className = "header corner-label";
    cornerTh.id = "cornerLabel";
    cornerTh.innerHTML = "Loading...";

    const colHeaderRow = document.createElement("tr");
    colHeaderRow.appendChild(cornerTh);
    colOrder.forEach(colNum => {
      const th = document.createElement("th");
      th.textContent = colNum;
      th.className = "header";
      colHeaderRow.appendChild(th);
    });
    table.appendChild(colHeaderRow);

    rowOrder.forEach(row => {
      const tr = document.createElement("tr");
      const rowTh = document.createElement("th");
      rowTh.textContent = row;
      rowTh.className = "header row-label";
      tr.appendChild(rowTh);

      colOrder.forEach(col => {
        const key = `${row}-${col}`;
        const td = document.createElement("td");
        td.textContent = gridMap[key] || "(empty)";
        if (!gridMap[key]) td.className = "empty";
        td.dataset.row = row;
        td.dataset.col = col;
        tr.appendChild(td);
      });

      table.appendChild(tr);
    });

    function getNameFromSquare(rowDigit, colDigit) {
      const row = parseInt(rowDigit);
      const col = parseInt(colDigit);
      const key = `${row}-${col}`;
      return gridMap[key] || "(empty)";
    }

    async function updateGame() {
      const gameId = document.getElementById("gameId")?.value?.trim() || DEFAULT_GAME_ID;
      document.getElementById("status").textContent = "Refreshing...";

      try {
        const url = `https://site.api.espn.com/apis/site/v2/sports/football/nfl/summary?event=${gameId}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);

        const data = await res.json();

        const comp = data.header?.competitions?.[0] || {};
        const competitors = comp.competitors || [];
        const home = competitors.find(c => c.homeAway === "home") || {};
        const away = competitors.find(c => c.homeAway === "away") || {};

        const homeScore = home.score || 0;
        const awayScore = away.score || 0;
        const homeName = home.team?.abbreviation || home.team?.displayName?.slice(0,3).toUpperCase() || "HOME";
        const awayName = away.team?.abbreviation || away.team?.displayName?.slice(0,3).toUpperCase() || "AWAY";

       
		document.getElementById("cornerLabel").innerHTML = `
		  <div style="font-size:0.75em; line-height:1.2;">
			${awayName} →
		  </div>
		  <div style="font-size:0.75em; line-height:1.2;">
			↓ ${homeName}
		  </div>
		`;


        document.getElementById("scoreDisplay").textContent = 
          `${awayName} ${awayScore} – ${homeScore} ${homeName}`;

        document.querySelectorAll("#gridTable td .quarter-label").forEach(el => el.remove());

        const homeQuarters = home.linescores || [];
        const awayQuarters = away.linescores || [];

        let html = "";

        if (homeQuarters.length > 0 || awayQuarters.length > 0) {
          html = "<strong>Quarter-by-Quarter Grid Winners:</strong><br>";
          let cumulativeHome = 0;
          let cumulativeAway = 0;

          const maxQ = Math.max(homeQuarters.length, awayQuarters.length, 4);

          for (let q = 0; q < maxQ; q++) {
            const homeQ = parseInt(homeQuarters[q]?.displayValue || "0", 10);
            const awayQ = parseInt(awayQuarters[q]?.displayValue || "0", 10);

            cumulativeHome += homeQ;
            cumulativeAway += awayQ;

            const qLabel = q < 4 ? `Q${q+1}` : (q === 4 ? "OT" : "Final");

            const awayLast = cumulativeAway % 10;
            const homeLast = cumulativeHome % 10;
            const winnerName = getNameFromSquare(awayLast, homeLast);

            const awayScoreText = cumulativeAway.toString().slice(0, -1) + `<span class="digit-bold">${awayLast}</span>`;
            const homeScoreText = cumulativeHome.toString().slice(0, -1) + `<span class="digit-bold">${homeLast}</span>`;

            html += `${qLabel}: ${awayName} ${awayScoreText} – ${homeName} ${homeScoreText} → ${winnerName}<br>`;

            document.querySelectorAll("#gridTable td").forEach(cell => {
              if (parseInt(cell.dataset.row) === awayLast && parseInt(cell.dataset.col) === homeLast) {
                const label = document.createElement("span");
                label.className = "quarter-label";
                label.textContent = `${qLabel} Win`;
                cell.appendChild(label);
              }
            });
          }
        }

        document.getElementById("quarterWinners").innerHTML = html;

        document.querySelectorAll(".pulsate, .current-winner-border").forEach(el => {
          el.classList.remove("pulsate", "current-winner-border");
        });

        document.querySelectorAll("#gridTable td").forEach(cell => {
          if (parseInt(cell.dataset.row) === awayScore % 10 && parseInt(cell.dataset.col) === homeScore % 10) {
            cell.classList.add("pulsate", "current-winner-border");
          }
        });

        const now = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
        document.getElementById("status").textContent = `Last refresh: ${now}`;

      } catch (err) {
        console.error(err);
        document.getElementById("status").textContent = `Error: ${err.message || "Failed to load"}`;
      }
    }

    updateGame();
    setInterval(updateGame, 10000);
    document.getElementById("refreshBtn").addEventListener("click", updateGame);
  </script>

</body>
</html>